import{_ as i,o as a,c as e,ag as n}from"./chunks/framework.DEqXEGcv.js";const t="/assets/webbroker.CfwDSJfK.png",E=JSON.parse('{"title":"Server Setup","description":"","frontmatter":{},"headers":[],"relativePath":"server-setup.md","filePath":"server-setup.md","lastUpdated":1772228606000}'),l={name:"server-setup.md"};function p(r,s,h,o,k,d){return a(),e("div",null,[...s[0]||(s[0]=[n(`<h1 id="server-setup" tabindex="-1">Server Setup <a class="header-anchor" href="#server-setup" aria-label="Permalink to &quot;Server Setup&quot;">​</a></h1><p>This guide explains how to create an MCP server with MCPConnect, covering the available transport options, their trade-offs, and the plugin configuration system.</p><h2 id="mcp-transport-types" tabindex="-1">MCP Transport Types <a class="header-anchor" href="#mcp-transport-types" aria-label="Permalink to &quot;MCP Transport Types&quot;">​</a></h2><p>The MCP specification defines two transport mechanisms:</p><table tabindex="0"><thead><tr><th>Transport</th><th>Description</th></tr></thead><tbody><tr><td><strong>Standard I/O (stdio)</strong></td><td>Server communicates via standard input/output streams. The MCP client launches the server process and exchanges JSON-RPC messages through stdin/stdout.</td></tr><tr><td><strong>Streamable HTTP</strong></td><td>Server exposes an HTTP endpoint. The MCP client connects over the network and communicates via HTTP requests.</td></tr></tbody></table><p>The right choice depends on your deployment scenario:</p><ul><li>Use <strong>stdio</strong> when the MCP client manages the server lifecycle directly (e.g., Claude Desktop, local integrations).</li><li>Use <strong>Streamable HTTP</strong> when the server must be accessible over a network or must serve multiple clients concurrently.</li></ul><h2 id="stdio-transport" tabindex="-1">Stdio Transport <a class="header-anchor" href="#stdio-transport" aria-label="Permalink to &quot;Stdio Transport&quot;">​</a></h2><p>A stdio server is a console application. The MCP client process spawns it, then communicates through its stdin/stdout pipes. This is the simplest transport and requires no network configuration.</p><p><strong>Create a Console Application</strong> (<code>{$APPTYPE CONSOLE}</code>) and add <code>MCPConnect.Transport.Stdio</code> to the uses clause.</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  System.SysUtils,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.JRPC.Server,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.MCP.Server.Api, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This will enable the standard MCP API!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Transport.Stdio,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Configuration.MCP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Content.Writers.RTL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Content.Writers.VCL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MyApp.Tools;   </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Unit with your MCP tool classes</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">procedure</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> StartServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">var</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LJRPCServer: TJRPCServer;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LStdioServer: TJRPCStdioServer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LJRPCServer := TJRPCServer.Create(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LJRPCServer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .Plugin.Configure&lt;IMCPConfig&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .Server</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .SetName(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-mcp-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .SetVersion(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.0.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .SetCapabilities([Tools])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .RegisterWriter(TMCPStreamWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .BackToMCP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .Tools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">          .RegisterClass(TMyTool)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .BackToMCP;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LStdioServer := TJRPCStdioServer.Create(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">nil</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    try</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      LStdioServer.Server := LJRPCServer;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      LStdioServer.StartServerAndWait;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    finally</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      LStdioServer.Free;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  finally</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    LJRPCServer.Free;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  try</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    StartServer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  except</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">    on</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> E: Exception </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      Writeln(ErrOutput, E.ClassName, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;: &#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, E.</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">Message</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.</span></span></code></pre></div><p><code>StartServerAndWait</code> blocks until the client closes the connection, making it the typical entry point for stdio servers.</p><p>As an alternative, you can manage the loop manually using <code>StartServer</code> and <code>ProcessRequests</code>. This is useful when you need to interleave MCP request processing with other work (logging, watchdog pings, periodic tasks, etc.):</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">LStdioServer.StartServer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">while</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> LStdioServer.Terminated </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">do</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  LStdioServer.ProcessRequests;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Sleep(</span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">1000</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Writeln(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;ping&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><code>ProcessRequests</code> handles any pending incoming messages and returns immediately, while <code>Terminated</code> becomes <code>True</code> when the client closes the connection.</p><p><strong>Pros:</strong></p><ul><li>Zero network configuration — no ports, firewalls, or TLS to manage.</li><li>Simple lifecycle — the client controls when the server starts and stops.</li><li>Ideal for local tools and desktop integrations.</li></ul><p><strong>Cons:</strong></p><ul><li>Single-client only — each client spawns its own process.</li><li>Not suitable for network-accessible or multi-tenant deployments.</li></ul><h2 id="streamable-http-transport" tabindex="-1">Streamable HTTP Transport <a class="header-anchor" href="#streamable-http-transport" aria-label="Permalink to &quot;Streamable HTTP Transport&quot;">​</a></h2><p>MCPConnect provides two HTTP transport implementations: <strong>WebBroker</strong> and <strong>Indy</strong>. Both expose the same MCP protocol over HTTP, but differ in architecture and flexibility.</p><h3 id="webbroker" tabindex="-1">WebBroker <a class="header-anchor" href="#webbroker" aria-label="Permalink to &quot;WebBroker&quot;">​</a></h3><p>WebBroker is Delphi&#39;s built-in framework for web server applications. MCPConnect integrates with it through <code>TJRPCDispatcher</code>, a component that plugs into the WebBroker request pipeline.</p><p><strong>Create a Web Server Application</strong> via <strong>File → New → Other → Web → Web Server Application</strong>. The deployment target (standalone, ISAPI, Apache module, CGI, FastCGI) is selected at project creation time and can be changed later without touching your MCP code.</p><p><img src="`+t+`" alt="Delphi WebBroker Wizard"></p><p>Add the configuration in your <code>TWebModule.OnCreate</code> event:</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  Web.HTTPApp,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.JRPC.Server,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.MCP.Server.Api, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This will enable the standard MCP API!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Transport.WebBroker,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Configuration.MCP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Content.Writers.RTL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Content.Writers.VCL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MyApp.Tools,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MyApp.Resources;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">procedure</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TWebModule1.WebModuleCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Sender: TObject);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FJRPCServer := TJRPCServer.Create(Self);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FJRPCServer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .Plugin.Configure&lt;IMCPConfig&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .Server</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .SetName(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-mcp-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .SetVersion(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.0.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .SetCapabilities([Tools, Resources])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .RegisterWriter(TMCPImageWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .RegisterWriter(TMCPStreamWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .BackToMCP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .Resources</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .SetBasePath(GetCurrentDir + </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;\\data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .RegisterClass(TWeatherResource)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .RegisterFile(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;docs\\readme.md&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Documentation&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .BackToMCP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .Tools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .RegisterClass(TMyTool)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .BackToMCP;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FJRPCDispatcher := TJRPCDispatcher.Create(Self);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FJRPCDispatcher.PathInfo := </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;/mcp&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FJRPCDispatcher.Server := FJRPCServer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><h4 id="automatic-integration-with-webbroker" tabindex="-1">Automatic Integration with WebBroker <a class="header-anchor" href="#automatic-integration-with-webbroker" aria-label="Permalink to &quot;Automatic Integration with WebBroker&quot;">​</a></h4><p><code>TJRPCDispatcher</code> integrates with WebBroker through Delphi&#39;s standard component ownership. When created with the <code>TWebModule</code> as owner, it registers itself automatically — no additional wiring is needed:</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// Self = TWebModule; this single line registers the dispatcher with WebBroker</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FJRPCDispatcher := TJRPCDispatcher.Create(Self);</span></span></code></pre></div><p>For each incoming request, WebBroker iterates its registered dispatchers and routes the request to the one whose <code>PathInfo</code> matches. Your MCP endpoint will be available at <code>/mcp</code> (or any path you choose).</p><p><strong>Pros:</strong></p><ul><li>Deploy as standalone, ISAPI, Apache module, CGI, or FastCGI without changing MCP code.</li><li>Integrates naturally into existing WebBroker applications alongside other web actions.</li><li>Lifecycle managed by the web server host.</li></ul><p><strong>Cons:</strong></p><ul><li>HTTP behavior (timeouts, headers, keep-alive) is controlled by the WebBroker host, not by your code.</li><li>Less direct access to raw HTTP connection details.</li></ul><h3 id="indy" tabindex="-1">Indy <a class="header-anchor" href="#indy" aria-label="Permalink to &quot;Indy&quot;">​</a></h3><p>The Indy transport embeds a <code>TIdHTTPServer</code>-based HTTP server directly in your application via <code>TJRPCIndyServer</code>. This gives you fine-grained control over every aspect of the HTTP server.</p><p><strong>Create a VCL Application</strong> and add <code>MCPConnect.Transport.Indy</code> to the uses clause. The server is typically created and configured in the main form:</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.JRPC.Server,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.MCP.Server.Api, </span><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">// This will enable the standard MCP API!</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Transport.Indy,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Configuration.MCP,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Content.Writers.RTL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Content.Writers.VCL,</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MyApp.Tools;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">procedure</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TForm1.FormCreate</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">(Sender: TObject);</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FJRPCServer := TJRPCServer.Create(Self);</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FJRPCServer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .Plugin.Configure&lt;IMCPConfig&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .Server</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .SetName(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;my-mcp-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .SetVersion(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;1.0.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .SetCapabilities([Tools])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .RegisterWriter(TMCPStreamWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .BackToMCP</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .Tools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">        .RegisterClass(TMyTool)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">      .BackToMCP;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FIndyServer := TJRPCIndyServer.Create(Self);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  FIndyServer.Server := FJRPCServer;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">procedure</span><span style="--shiki-light:#6F42C1;--shiki-dark:#B392F0;"> TForm1.StartServer</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">begin</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  if</span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;"> not</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;"> FIndyServer.Active </span><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">then</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  begin</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FIndyServer.DefaultPort := StrToInt(EditPort.Text);</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    FIndyServer.Active := </span><span style="--shiki-light:#005CC5;--shiki-dark:#79B8FF;">True</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">  end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span>
<span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">end</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">;</span></span></code></pre></div><p><code>TJRPCIndyServer</code> exposes all standard <code>TIdHTTPServer</code> properties and events, so you can configure SSL/TLS, bind to specific interfaces, tune thread pool sizes, handle authentication events, and more.</p><p><strong>Pros:</strong></p><ul><li>Full control over HTTP server behavior: SSL, threading, binding, custom events.</li><li>Suitable for self-hosted services that need custom network-level configuration.</li><li>No dependency on WebBroker or a web server host.</li></ul><p><strong>Cons:</strong></p><ul><li>Requires more configuration for production deployments (TLS, load balancing, etc.).</li><li>Does not plug into existing WebBroker applications.</li></ul><h2 id="plugin-system-and-fluent-interface" tabindex="-1">Plugin System and Fluent Interface <a class="header-anchor" href="#plugin-system-and-fluent-interface" aria-label="Permalink to &quot;Plugin System and Fluent Interface&quot;">​</a></h2><p><code>TJRPCServer</code> is configured through a <strong>plugin system</strong> based on a fluent interface. Each feature area — MCP configuration, sessions, authentication, JSON serialization — is encapsulated in a separate plugin, registered via <code>.Plugin.Configure&lt;IPluginInterface&gt;</code>.</p><p>The general pattern is:</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FJRPCServer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .Plugin.Configure&lt;IPluginA&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .SetOption1(...)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .SetOption2(...)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .ApplyConfig</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .Plugin.Configure&lt;IPluginB&gt;</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    ...</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .ApplyConfig;</span></span></code></pre></div><p>Each <code>.Plugin.Configure&lt;T&gt;</code> call returns the interface <code>T</code>, exposing the configuration methods for that plugin. When finished, <code>.ApplyConfig</code> returns to the <code>TJRPCServer</code> so the next plugin can be chained.</p><blockquote><p>This chapter covers only the <code>IMCPConfig</code> plugin. Later chapters will address the session management plugin (<code>ISessionConfig</code>), the authentication plugin (<code>IAuthTokenConfig</code>), and the JSON serialization plugin (<code>IJRPCNeonConfig</code>).</p></blockquote><h2 id="the-imcpconfig-plugin" tabindex="-1">The IMCPConfig Plugin <a class="header-anchor" href="#the-imcpconfig-plugin" aria-label="Permalink to &quot;The IMCPConfig Plugin&quot;">​</a></h2><p><code>IMCPConfig</code> is the core configuration plugin. It declares the server&#39;s identity, its MCP capabilities, and registers the tool and resource classes that implement the MCP API.</p><p>Access it with:</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#D73A49;--shiki-dark:#F97583;">uses</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  MCPConnect.Configuration.MCP;</span></span></code></pre></div><p>The plugin is divided into three sub-sections, each accessed by name and terminated with <code>.BackToMCP</code>:</p><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">FJRPCServer</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .Plugin.Configure&lt;IMCPConfig&gt;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .Server</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Server identity and capabilities</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .BackToMCP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .Resources</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Resource registration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .BackToMCP</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .Tools</span></span>
<span class="line"><span style="--shiki-light:#6A737D;--shiki-dark:#6A737D;">      // Tool registration</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">    .BackToMCP;</span></span></code></pre></div><h3 id="server-section" tabindex="-1">Server Section <a class="header-anchor" href="#server-section" aria-label="Permalink to &quot;Server Section&quot;">​</a></h3><p>The <code>.Server</code> section declares the server&#39;s identity and which MCP capabilities it exposes.</p><table tabindex="0"><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><code>SetName(name)</code></td><td>Server name reported during MCP initialization</td></tr><tr><td><code>SetVersion(version)</code></td><td>Server version string</td></tr><tr><td><code>SetCapabilities([...])</code></td><td>Declares which MCP capabilities are active: <code>Tools</code>, <code>Resources</code>, <code>Prompts</code></td></tr><tr><td><code>RegisterWriter(class)</code></td><td>Registers a content writer for converting Delphi types to MCP content</td></tr></tbody></table><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.Server</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .SetName(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;delphi-mcp-server&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .SetVersion(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;2.0.0&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .SetCapabilities([Tools, Resources])</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterWriter(TMCPImageWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterWriter(TMCPPictureWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterWriter(TMCPStreamWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterWriter(TMCPStringListWriter)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.BackToMCP</span></span></code></pre></div><p><code>SetCapabilities</code> controls which capability blocks appear in the MCP <code>initialize</code> response. Only declare capabilities you actually use.</p><p>Content writers (see the Content Writers chapter) teach MCPConnect how to serialize specific Delphi types — <code>TStream</code>, <code>TPicture</code>, <code>TStringList</code>, etc. — as MCP content items.</p><h3 id="tools-section" tabindex="-1">Tools Section <a class="header-anchor" href="#tools-section" aria-label="Permalink to &quot;Tools Section&quot;">​</a></h3><p>The <code>.Tools</code> section registers the Delphi classes that contain methods decorated with <code>[McpTool]</code>.</p><table tabindex="0"><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><code>RegisterClass(class)</code></td><td>Registers a class whose <code>[McpTool]</code> methods are exposed as MCP tools</td></tr></tbody></table><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.Tools</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterClass(THelpDeskService)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterClass(TTestTool)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.BackToMCP</span></span></code></pre></div><p>MCPConnect inspects each registered class via RTTI and automatically generates the MCP tool schema from method signatures and <code>[McpParam]</code> attributes. See the Tools chapter for details on annotating tool methods.</p><h3 id="resources-section" tabindex="-1">Resources Section <a class="header-anchor" href="#resources-section" aria-label="Permalink to &quot;Resources Section&quot;">​</a></h3><p>The <code>.Resources</code> section registers classes with <code>[McpResource]</code> methods and static files.</p><table tabindex="0"><thead><tr><th>Method</th><th>Description</th></tr></thead><tbody><tr><td><code>SetBasePath(path)</code></td><td>Base directory for resolving relative file paths</td></tr><tr><td><code>RegisterClass(class)</code></td><td>Registers a class whose <code>[McpResource]</code> methods are exposed as MCP resources</td></tr><tr><td><code>RegisterFile(path, name)</code></td><td>Exposes a static file as an MCP resource</td></tr></tbody></table><div class="language-pascal vp-adaptive-theme"><button title="Copy Code" class="copy"></button><span class="lang">pascal</span><pre class="shiki shiki-themes github-light github-dark vp-code" tabindex="0"><code><span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.Resources</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .SetBasePath(GetCurrentDir + </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;\\data&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterClass(TWeatherResource)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterClass(TDeplphiDayApp)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterFile(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;index.md&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;Index&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">  .RegisterFile(</span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;documentation\\mcp\\mcpconnect.pdf&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">, </span><span style="--shiki-light:#032F62;--shiki-dark:#9ECBFF;">&#39;MCPConnect Introduction&#39;</span><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">)</span></span>
<span class="line"><span style="--shiki-light:#24292E;--shiki-dark:#E1E4E8;">.BackToMCP</span></span></code></pre></div><p><code>SetBasePath</code> is used as the root for <code>RegisterFile</code> relative paths. See the Resources chapter for details on implementing resource classes.</p>`,72)])])}const g=i(l,[["render",p]]);export{E as __pageData,g as default};
